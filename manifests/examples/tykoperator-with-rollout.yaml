apiVersion: vourteen14.labs/v1
kind: TykRoute
metadata:
  name: auth-api
  namespace: default
  labels:
    app: auth-api
    env: production
    security: jwt
spec:
  target:
    configMapName: dynamic-api-routes
    namespace: default
    tykDeployment: tyk-gateway

  apiDefinition:
    name: "Authentication API"
    api_id: "auth-api-v1"
    active: true
    use_keyless: false
    enable_jwt: true

    # JWT Configuration
    jwt_signing_method: "rsa"
    jwt_source: "Authorization"
    jwt_identity_base_field: "sub"
    jwt_policy_field_name: "pol"
    jwt_default_policies:
      - "authenticated-user"

    proxy:
      listen_path: "/api/auth/"
      target_url: "http://auth-service.default.svc.cluster.local:8080"
      strip_listen_path: true
      preserve_host_header: false

    global_rate_limit:
      rate: 50
      per: 60

    do_not_track: false
    enable_detailed_recording: true

    global_response_headers:
      X-Content-Type-Options: "nosniff"
      X-Frame-Options: "DENY"
      Strict-Transport-Security: "max-age=31536000; includeSubDomains"

    global_response_headers_remove:
      - "Server"
      - "X-Powered-By"

    version_data:
      not_versioned: true
      versions:
        Default:
          name: "v1"
